<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Formula :: Frosthaven Enhanced</title>
    <meta name="generator" content="Antora 3.0.3">
    <link rel="stylesheet" href="../../../_/css/site.css">
    <link rel="stylesheet" href="../../../_/css/gh-site.css">
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="../../..">Frosthaven Enhanced</a>
      <div class="navbar-item search hide-for-print">
        <div id="search-field" class="field">
          <input id="search-input" type="text" placeholder="Search the docs">
        </div>
      </div>
      <button class="navbar-burger" aria-controls="topbar-nav" aria-expanded="false" aria-label="Toggle main menu">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Steam</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="https://steamcommunity.com/sharedfiles/filedetails/?id=3307604810">Frosthaven Enhanced</a>
            <a class="navbar-item" href="https://steamcommunity.com/sharedfiles/filedetails/?id=2891465199">Gloomhaven Enhanced</a>
          </div>
        </div>
        <a class="navbar-item" href="https://discord.com/channels/847227635892224020/847987593747496990/848737045089615894">Discord</a>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="custom" data-version="2.5">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <button class="nav-menu-toggle" aria-label="Toggle expand/collapse all" style="display: none"></button>
    <h3 class="title"><a href="../index.html">Custom Content</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <span class="nav-text">Introduction</span>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../contentbox.html">Content Box</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../scenario/index.html">Scenarios</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../scenario/monsters.html">Monsters</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../scenario/overlays.html">Overlays</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../scenario/grid.html">Grid</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../scenario/expressions.html">Expressions</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Tools</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../tools/enhancementTool.html">Enhancement Tool</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../tools/sectionTool.html">Section Tool</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../library/index.html">Libraries</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">Custom Content</span>
    <span class="version">2.5 next</span>
  </div>
  <ul class="components">
    <li class="component">
      <div class="title"><a href="../../../creator/index.html">Custom Class Creator</a></div>
    </li>
    <li class="component is-current">
      <div class="title"><a href="../../latest/index.html">Custom Content</a></div>
      <ul class="versions">
        <li class="version is-current">
          <a href="../index.html">2.5 next</a>
        </li>
        <li class="version is-latest">
          <a href="../../latest/index.html">2.4</a>
        </li>
        <li class="version">
          <a href="../../1.3/index.html">1.3</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <div class="title"><a href="../../../dev/index.html">Development</a></div>
    </li>
    <li class="component">
      <div class="title"><a href="../../../mod/latest/index.html">Frosthaven Enhanced</a></div>
      <ul class="versions">
        <li class="version">
          <a href="../../../mod/next/index.html">2.5 next</a>
        </li>
        <li class="version is-latest">
          <a href="../../../mod/latest/index.html">2.4</a>
        </li>
        <li class="version">
          <a href="../../../mod/1.3/index.html">1.3</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../index.html">Custom Content</a></li>
    <li><a href="formula.html">Formula</a></li>
  </ul>
</nav>
<div class="page-versions">
  <button class="version-menu-toggle" title="Show other versions of page">2.5 next</button>
  <div class="version-menu">
    <a class="version is-current" href="formula.html">2.5 next</a>
    <a class="version" href="../../latest/common/formula.html">2.4</a>
    <a class="version" href="../../1.3/common/formula.html">1.3</a>
  </div>
</div>
<div class="edit-this-page"><a href="https://github.com/gloomhaven-tts-enhanced/public-scripts/edit/next/docs/content/customContent/modules/ROOT/pages/common/formula.adoc">Edit this Page</a></div>
</div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">Formula</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>Formulas are a way to describe dynamic values within the scenario.
The most typical use case would be HP values of obstacles or enemies that scale with the number of characters or the current scenario level.</p>
</div>
<div class="paragraph">
<p>Formulas are defined with Lua tables.
The first entry is the operator that is used and the following entries are the arguments for the operator, which itself are formulas.
Every number is a formula in itself, so wherever a formula is required, a number can also be provided.
Strings in formulas are considered to be variables and will be resolved in the given context (e.g. "L" or "C" like in the scenario book).
Which variables are available depends on the context where the formula is used (see below).
Arguments can be formulas, too which is used to</p>
</div>
<div class="paragraph">
<p>E.g. the expression <code>2 + 4 * 5</code> would be defined as this formula;</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-lua hljs" data-lang="lua">{ "+", 2, { "*", 4, 5 } } --&gt; resolves to 22</code></pre>
</div>
</div>
<div class="paragraph">
<p>This shows that formulas are resolved from inner to outer.
Before an operator can be executed all its arguments have to be resolved first.
So in order for the addition to work, the multiplication formula will be resolved first.</p>
</div>
<div class="paragraph">
<p>Looking at the <a href="#Example_Formula">Examples</a> the usage should get clearer. :-)</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_available_operators"><a class="anchor" href="#_available_operators"></a>Available Operators</h2>
<div class="sectionbody">
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Operator</th>
<th class="tableblock halign-left valign-top">Arguments</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>+</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">List&lt;Formula&gt;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Adds the resolved formula values.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">List&lt;Formula&gt;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Subtracts the resolved formula values (left to right).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>*</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">List&lt;Formula&gt;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Multiplies the resolved formula values.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">List&lt;Formula&gt;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Divides the resolved formula values (left to right).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>roundUp</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Formula</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Rounds the resolved formula value up.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>roundDown</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Formula</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Rounds the resolved formula value down.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>apply</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2 or 3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Calls a function and returns the function&#8217;s value. The name of the function is the first argument. If the second argument is a String, this is the GUID of the object that contains the function. Then the third argument is the table of parameters passed to the function. Otherwise, the second argument is the table of parameters passed to the function and the function has to be on the object that defines the formula. Variables within the parameters will also be resolved.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>if</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A List with 3 Formula</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Checks if the first argument value is <code>true</code>. If this is the case, it will return the second argument&#8217;s value, otherwise it will return the third argument&#8217;s value.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>byScenarioLevel</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">List&lt;Formula&gt;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Return the formula</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect1">
<h2 id="_available_variables"><a class="anchor" href="#_available_variables"></a>Available Variables</h2>
<div class="sectionbody">
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 33.3333%;">
<col style="width: 50.0001%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Variable</th>
<th class="tableblock halign-left valign-top">Context</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">All</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The number of player characters.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">L</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">All</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The current scenario level.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">H</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enemies</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The standard HP value for the enemy at the current scenario level and difficulty.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">self</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">All</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The GUID of the object for which the formula is calculated.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Global</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">All</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A reference to the Global object.</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect1">
<h2 id="Example_Formula"><a class="anchor" href="#Example_Formula"></a>Examples</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Every number is a formula in itself, so it can be used directly.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-lua hljs" data-lang="lua">hp = 4</code></pre>
</div>
</div>
<div class="paragraph">
<p>Variables are also a formula in itself.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-lua hljs" data-lang="lua">hp = "L"</code></pre>
</div>
</div>
<div class="paragraph">
<p>The four basic arithmetic operators can be used like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-lua hljs" data-lang="lua">hp = { "+", "C", 3} -- C + 3
hp = { "-", "C", 3} -- C - 3
hp = { "*", "H", 2} -- H * 2
hp = { "/", "H", 2} -- H / 2</code></pre>
</div>
</div>
<div class="paragraph">
<p>Multiple operators can be combined with an argument as a formula table.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-lua hljs" data-lang="lua">hp = { "+", 20, "L", {"*", 2, "C"}, } -- 20 + L + (2 * C)</code></pre>
</div>
</div>
<div class="paragraph">
<p>With division, rounding is also relevant.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-lua hljs" data-lang="lua">hp = { "roundUp", { "/", {"*", "H", "C"}, 2 } } -- (H * C) / 2, rounded up</code></pre>
</div>
</div>
<div class="paragraph">
<p>To mimic monster stats it&#8217;s possible to use the <code>byScenarioLevel</code> operator.
It  returns the value from the argument afterwards, that matches the current scenario level.
E.g. the following formula would return 1 for scenario level 0 and 1, 2 for scenario level 2 and so forth:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-lua hljs" data-lang="lua">hp = { "byScenarioLevel", 1, 1, 2, 2, 3, 4, 5, 6 }</code></pre>
</div>
</div>
<div class="paragraph">
<p>Functions can be called, too.
Since Strings are considered to be variables, they have to be prefixed with a <code>$</code> if the literal String is meant (e.g. for the function name to be called).
This also applies to all values inside the parameters of the <code>apply</code> operator.
E.g. this example will set the HP value of the object the formula is attached to, to the same value as the "Prime Demon" enemy has.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-lua hljs" data-lang="lua">hp = { "apply", "$setHealthFromEnemy", "Global", { enemy = "$Prime Demon", object = "self" }, }</code></pre>
</div>
</div>
<div class="paragraph">
<p>It might be useful to combine the <code>if</code> operator with the <code>apply</code> operator.
E.g. this example will either resolve to the value 0 or 1, depending on whether the current party has the "Dimensional Equilibrium" achievement or not (which is checked by the <code>hasPartyAchievement</code> function).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-lua hljs" data-lang="lua">levelModifier = { "if", { "apply", "$hasPartyAchievement", "Global", { name = "$Dimensional Equilibrium" }, }, 0, 1 }</code></pre>
</div>
</div>
</div>
</div>
</article>
  </div>
</main>
</div>
<footer class="footer">
  <p>This page was built using the Antora default UI.</p>
  <p>The source code for this UI is licensed under the terms of the MPL-2.0 license.</p>
</footer>
<script id="site-script" src="../../../_/js/site.js" data-ui-root-path="../../../_"></script>
<script async src="../../../_/js/vendor/highlight.js"></script>
<script src="../../../_/js/vendor/lunr.js"></script>
<script src="../../../_/js/search-ui.js" id="search-ui-script" data-site-root-path="../../.." data-snippet-length="200" data-stylesheet="../../../_/css/search.css"></script>
<script async src="../../../search-index.js"></script>
  </body>
</html>
