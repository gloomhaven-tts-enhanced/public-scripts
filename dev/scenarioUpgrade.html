<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Upgrading Scenarios :: Gloomhaven Enhanced</title>
    <meta name="generator" content="Antora 3.1.9">
    <link rel="stylesheet" href="../_/css/site.css">
    <link rel="stylesheet" href="../_/css/gh-site.css">
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="..">Gloomhaven Enhanced</a>
      <div class="navbar-item search hide-for-print">
        <div id="search-field" class="field">
          <input id="search-input" type="text" placeholder="Search the docs">
        </div>
      </div>
      <button class="navbar-burger" aria-controls="topbar-nav" aria-expanded="false" aria-label="Toggle main menu">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Steam</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="https://steamcommunity.com/sharedfiles/filedetails/?id=3307604810">Frosthaven Enhanced</a>
            <a class="navbar-item" href="https://steamcommunity.com/sharedfiles/filedetails/?id=2891465199">Gloomhaven Enhanced</a>
          </div>
        </div>
        <a class="navbar-item" href="https://discord.com/channels/847227635892224020/847987593747496990/848737045089615894">Discord</a>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="dev" data-version="">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <button class="nav-menu-toggle" aria-label="Toggle expand/collapse all" style="display: none"></button>
    <h3 class="title"><a href="index.html">Development</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="index.html">Introduction</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="documentation.html">Documentation</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="commandLine.html">Command Line</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Workflows</span>
<ul class="nav-list">
  <li class="nav-item is-current-page" data-depth="2">
    <a class="nav-link" href="scenarioUpgrade.html">Upgrading Scenarios</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Engine</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="engine/campaignManager.html">Campaign Manager</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Frosthaven</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="frosthaven/campaignManager.html">Campaign Manager</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="frosthaven/sourceOfTruth.html">Sources of Truth</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Gloomhaven</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="gloomhaven/campaignManager.html">Campaign Manager</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="gloomhaven/sourceOfTruth.html">Sources of Truth</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">Development</span>
    <span class="version"></span>
  </div>
  <ul class="components">
    <li class="component">
      <div class="title"><a href="../creator/index.html">Custom Class Creator</a></div>
    </li>
    <li class="component">
      <div class="title"><a href="../custom/latest/index.html">Custom Content</a></div>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../custom/latest/index.html">2.3</a>
        </li>
        <li class="version">
          <a href="../custom/1.3/index.html">1.3</a>
        </li>
      </ul>
    </li>
    <li class="component is-current">
      <div class="title"><a href="index.html">Development</a></div>
    </li>
    <li class="component">
      <div class="title"><a href="../mod/latest/index.html">Frosthaven Enhanced</a></div>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../mod/latest/index.html">2.2</a>
        </li>
        <li class="version">
          <a href="../mod/1.3/index.html">1.3</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="index.html">Development</a></li>
    <li>Workflows</li>
    <li><a href="scenarioUpgrade.html">Upgrading Scenarios</a></li>
  </ul>
</nav>
<div class="edit-this-page"><a href="https://github.com/gloomhaven-tts-enhanced/public-scripts/edit/main/docs/content/development/modules/ROOT/pages/scenarioUpgrade.adoc">Edit this Page</a></div>
</div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">Upgrading Scenarios</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>This describes the process of upgrading scenarios from the old scenario format to the new scenario format.
The following terms are used to describe specific directories inside the repository:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Code directory</dt>
<dd>
<p>The directory <code>packages/code</code>.</p>
</dd>
<dt class="hdlist1">Mod directory</dt>
<dd>
<p>The directory <code>mods/game/Frosthaven</code>.</p>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_convert_the_old_scenario_definition"><a class="anchor" href="#_convert_the_old_scenario_definition"></a>Convert the old scenario definition</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Execute the command <code>pnpm scenario &lt;index&gt;</code> (e.g. <code>pnpm scenario 4</code>) inside the <code>packages/script</code> directory of the repository.
This will read the file <code>FH_&lt;index&gt;.lua</code> (e.g. <code>FH_004.lua</code>) and convert it to the new scenario format.
It will create a file <code>fh-&lt;index&gt;.ts</code> (e.g. <code>fh-4.ts</code>) inside the <code>src/game/frosthaven/scenario</code> directory of the code directory.
This file needs to be updated to change the scenario.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="convert"><a class="anchor" href="#convert"></a>Convert the scenario definition to a <code>.lua</code> file</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The generated scenario definition is a TypeScript file.
To make it usable inside TTS, it needs to be a Lua file.
Run the command <code>pnpm build</code> inside the code directory to convert all TypeScript files to Lua files.
Alternatively, you could execute the command <code>pnpm dev</code> inside the same directory and keep the command line open where this command was executed.
This will start a watching process on all TypeScript files.
Whenever a TypeScript file is saved, it&#8217;s automatically converted to the Lua file as long as this process is running.
Otherwise, the <code>pnpm build</code> command needs to be executed each time.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_add_the_scenario_to_the_frosthaven_game_box"><a class="anchor" href="#_add_the_scenario_to_the_frosthaven_game_box"></a>Add the scenario to the Frosthaven game box</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The above steps only create the scenario script itself, but not the token that holds that scenario.
Open the file <code>campaign.yaml</code> inside the <code>data</code> directory of the mod directory.
Add the index of the new scenario to the existing list.</p>
</div>
<div class="listingblock">
<div class="title">Example content of the <code>campaign.yaml</code> file</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">kind: campaign
name: Frosthaven
scenarios:
  - "1"
  - "2"
  - "3"
  - "4"
  # New scenarios are added here, and should be sorted</code></pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Be sure to surround the numbers with <code>"</code>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Then execute the <code>pnpm embed</code> command from the mod directory (or the <code>pnpm embed:fh</code> command from the root directory which also includes this command).
This will generate the token that holds the scenario script and add it to the game box.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_remove_the_old_scenario"><a class="anchor" href="#_remove_the_old_scenario"></a>Remove the old scenario</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Inside the mod directory, find the directory  <code>content/Frosthaven.frosthaven/AutoAssets.assets/Scenarios.scenarios</code>.
Open the <code>Contents.json</code> file inside this directory and remove the entry for the removed scenario.
It can be identified by checking the scenario index.</p>
</div>
<div class="listingblock">
<div class="title">Before</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">[
  {
    "path": "./FH-000.9911c9"
  },
  {
    "path": "./FH-004.831416"
  },
  {
    "path": "./FH-005.5f8908"
  }
]</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">After</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">[
  {
    "path": "./FH-000.9911c9"
  },
  {
    "path": "./FH-005.5f8908"
  }
]</code></pre>
</div>
</div>
<div class="paragraph">
<p>Also, delete the directory of the same name inside that directory.
Embedding again will remove the old scenario from the game box.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_testing_and_changing_the_scenario"><a class="anchor" href="#_testing_and_changing_the_scenario"></a>Testing and changing the scenario</h2>
<div class="sectionbody">
<div class="paragraph">
<p>First, load FHE as usual and start a new campaign.
Then, spawn the new scenario.
This is easiest by entering <code>&gt;spawn-scenario fh-&lt;index&gt;</code> (e.g. <code>&gt;spawn-scenario fh-4</code>) into the chat window.
Now save the game and load it again.</p>
</div>
<div class="paragraph">
<p>If everything already works as intended and is correctly placed, that&#8217;s great.
If not, make adjustments to the scenario definition.
In order to not do the whole embedding and loading process all the time, it&#8217;s easier to use VS Code with the TTS Editor extension (as mentioned <a href="setup.html#vs-code" class="xref page">here</a>).</p>
</div>
<div class="paragraph">
<p>First, make sure the <code>pnpm dev</code> command is running somewhere (as mentioned <a href="#convert">above</a>).
This makes sure that any changes to the scenario definition are directly converted to Lua.
Then use the VS Code command palette (<span class="keyseq"><kbd>CTRL</kbd>+<kbd>SHIFT</kbd>+<kbd>P</kbd></span> by default).
Search for the command "Update Object"</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/scenario/command-palette.png" alt="command palette">
</div>
</div>
<div class="paragraph">
<p>Selecting this command will open another popup where you can select an object currently on the table of the loaded TTS save.
Search for the scenario token (which always has the name <code>fh-&lt;index&gt;</code>).</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/scenario/update-object.png" alt="update object">
</div>
</div>
<div class="paragraph">
<p>Select that again and now the object will be updated in the background with the current script.
Now simply spawn the scenario again to get the latest scenario definition.
Again, use the chat window to make this faster as this also includes clearing the current map.
Use the <kbd>Arrow Up</kbd> key to easily get to the last entered chat message again instead of typing it again.</p>
</div>
</div>
</div>
</article>
  </div>
</main>
</div>
<footer class="footer">
  <p>This page was built using the Antora default UI.</p>
  <p>The source code for this UI is licensed under the terms of the MPL-2.0 license.</p>
</footer>
<script id="site-script" src="../_/js/site.js" data-ui-root-path="../_"></script>
<script async src="../_/js/vendor/highlight.js"></script>
<script src="../_/js/vendor/lunr.js"></script>
<script src="../_/js/search-ui.js" id="search-ui-script" data-site-root-path=".." data-snippet-length="200" data-stylesheet="../_/css/search.css"></script>
<script async src="../search-index.js"></script>
  </body>
</html>
